{"version":3,"sources":["client.js","graphql.js","App.js","index.js"],"names":["GITHUB_TOKEN","process","REACT_APP_GITHUB_TOKEN","headersLink","ApolloLink","operation","forward","setContext","headers","Authorization","httpLink","HttpLink","uri","link","from","ApolloClient","cache","InMemoryCache","SEARCH_REPOSITORIES","gql","ADD_STAR","REMOVE_STAR","StarButton","props","node","query","first","last","after","before","totalCount","stargazers","viewerHasStarred","starCount","StarStatus","addOrRemoveStar","onClick","variables","input","starrableId","id","update","store","data","addStar","removeStar","starrable","readQuery","newEdges","search","edges","map","edge","newTotalCount","writeQuery","mutation","DEFAUTL_STATE","App","useState","state","setState","myRef","useRef","client","onSubmit","event","preventDefault","current","value","ref","type","loading","error","message","repositoryCount","repositoryUnit","title","key","href","url","target","rel","name","pageInfo","hasPreviousPage","startCursor","goPrevious","hasNextPage","endCursor","goNext","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.2d8d6e79.chunk.js","sourcesContent":["import { ApolloClient } from \"apollo-client\";\nimport { ApolloLink } from \"apollo-link\";\nimport { HttpLink } from \"apollo-link-http\";\nimport { InMemoryCache } from \"apollo-cache-inmemory\";\n\nconst GITHUB_TOKEN = process.env.REACT_APP_GITHUB_TOKEN;\n\nconst headersLink = new ApolloLink((operation, forward) => {\n  operation.setContext({\n    headers: {\n      Authorization: `Bearer ${GITHUB_TOKEN}`\n    }\n  });\n  return forward(operation);\n});\n\nconst endpoint = \"https://api.github.com/graphql\";\nconst httpLink = new HttpLink({ uri: endpoint });\nconst link = ApolloLink.from([headersLink, httpLink]);\n\nexport default new ApolloClient({\n  link,\n  cache: new InMemoryCache()\n});\n","import gql from \"graphql-tag\";\n\n/**\n * on Repositoryと書いてあるのはinlineFragments\n * 明示的にRepository型というのを指定するため\n */\nexport const SEARCH_REPOSITORIES = gql`\n  query searchRepositories(\n    $first: Int\n    $after: String\n    $last: Int\n    $before: String\n    $query: String!\n  ) {\n    search(\n      first: $first\n      after: $after\n      last: $last\n      before: $before\n      query: $query\n      type: REPOSITORY\n    ) {\n      repositoryCount\n      pageInfo {\n        endCursor\n        hasNextPage\n        hasPreviousPage\n        startCursor\n      }\n      edges {\n        cursor\n        node {\n          ... on Repository {\n            id\n            name\n            url\n            stargazers {\n              totalCount\n            }\n            viewerHasStarred\n          }\n        }\n      }\n    }\n  }\n`;\n\nexport const ADD_STAR = gql`\n  mutation addStar($input: AddStarInput!) {\n    addStar(input: $input) {\n      starrable {\n        id\n        viewerHasStarred\n      }\n    }\n  }\n`;\n\nexport const REMOVE_STAR = gql`\n  mutation removeStar($input: RemoveStarInput!) {\n    removeStar(input: $input) {\n      starrable {\n        id\n        viewerHasStarred\n      }\n    }\n  }\n`;\n\nexport const ME = gql`\n  query me {\n    user(login: \"three4c\") {\n      name\n      avatarUrl\n    }\n  }\n`;\n","import React, { useState, useRef } from \"react\";\nimport { ApolloProvider, Mutation, Query } from \"react-apollo\";\nimport client from \"./client\";\nimport { ADD_STAR, REMOVE_STAR, SEARCH_REPOSITORIES } from \"./graphql\";\n\nconst StarButton = props => {\n  const { node, query, first, last, after, before } = props;\n  const totalCount = props.node.stargazers.totalCount;\n  const viewerHasStarred = node.viewerHasStarred;\n  const starCount = totalCount === 1 ? \"1 star\" : `${totalCount} starts`;\n  const StarStatus = ({ addOrRemoveStar }) => {\n    return (\n      <button\n        onClick={() =>\n          addOrRemoveStar({\n            variables: { input: { starrableId: node.id } },\n            update: (store, { data: { addStar, removeStar } }) => {\n              const { starrable } = addStar || removeStar;\n              const data = store.readQuery({\n                query: SEARCH_REPOSITORIES,\n                variables: { query, first, last, after, before }\n              });\n              const edges = data.search.edges;\n              const newEdges = edges.map(edge => {\n                if (edge.node.id === node.id) {\n                  const totalCount = edge.node.stargazers.totalCount;\n                  const diff = starrable.viewerHasStarred ? 1 : -1;\n                  const newTotalCount = totalCount + diff;\n                  edge.node.stargazers.totalCount = newTotalCount;\n                }\n                return edge;\n              });\n              data.search.edges = newEdges;\n              store.writeQuery({ query: SEARCH_REPOSITORIES, data });\n            }\n          })\n        }\n      >\n        {starCount} | {viewerHasStarred ? \"starred\" : \"-\"}\n      </button>\n    );\n  };\n  return (\n    <Mutation mutation={viewerHasStarred ? REMOVE_STAR : ADD_STAR}>\n      {addOrRemoveStar => <StarStatus addOrRemoveStar={addOrRemoveStar} />}\n    </Mutation>\n  );\n};\n\nconst PER_PAGE = 5;\nconst DEFAUTL_STATE = {\n  first: PER_PAGE,\n  after: null,\n  last: null,\n  before: null,\n  query: \"\"\n};\n\nconst App = () => {\n  const [state, setState] = useState(DEFAUTL_STATE);\n  const { query, first, last, before, after } = state;\n\n  const myRef = useRef(null);\n\n  const handleSubmit = event => {\n    event.preventDefault();\n    setState({\n      ...state,\n      query: myRef.current.value\n    });\n  };\n\n  const goNext = search => {\n    setState({\n      ...state,\n      first: PER_PAGE,\n      after: search.pageInfo.endCursor,\n      last: null,\n      before: null\n    });\n  };\n\n  const goPrevious = search => {\n    setState({\n      ...state,\n      first: null,\n      after: null,\n      last: PER_PAGE,\n      before: search.pageInfo.startCursor\n    });\n  };\n\n  return (\n    <ApolloProvider client={client}>\n      <form onSubmit={handleSubmit}>\n        <input ref={myRef} />\n        <input type=\"submit\" value=\"Submit\" />\n      </form>\n      <Query\n        query={SEARCH_REPOSITORIES}\n        variables={{ query, first, last, before, after }}\n      >\n        {({ loading, error, data }) => {\n          if (loading) return \"Loading...\";\n          if (error) return `Error! ${error.message}`;\n\n          const search = data.search;\n          const repositoryCount = search.repositoryCount;\n          const repositoryUnit =\n            repositoryCount === 1 ? \"Repository\" : \"Repositories\";\n          const title = `GitHub Repositories Search Results - ${repositoryCount} ${repositoryUnit}`;\n\n          return (\n            <>\n              <h2>{title}</h2>\n              <ul>\n                {search.edges.map(edge => {\n                  const node = edge.node;\n\n                  return (\n                    <li key={node.id}>\n                      <a\n                        href={node.url}\n                        target=\"_blank\"\n                        rel=\"noopener noreferrer\"\n                      >\n                        {node.name}\n                      </a>\n                      &nbsp;\n                      <StarButton\n                        node={node}\n                        {...{ query, first, last, after, before }}\n                      />\n                    </li>\n                  );\n                })}\n              </ul>\n              {search.pageInfo.hasPreviousPage === true ? (\n                <button onClick={() => goPrevious(search)}>Previous</button>\n              ) : null}\n              {search.pageInfo.hasNextPage === true ? (\n                // 引数のある関数は() => void形にしないとレンダー時に発火する\n                <button onClick={() => goNext(search)}>Next</button>\n              ) : null}\n            </>\n          );\n        }}\n      </Query>\n    </ApolloProvider>\n  );\n};\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport App from \"./App\";\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n"],"sourceRoot":""}